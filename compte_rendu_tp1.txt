TP1 : Redis et MongoDB : 


Partie 1 : 
Dans cette partie, on s'intéresse surtout à Redis. Redis est un SGBD NoSQL en mémoire. Il fonctionne comme un magasin clé-valeur, où les données sont associées à une clé unique et peuvent être récupérées à partir de cette clé. Grâce à son utilisation avec une autre base de données relationnelle, il arrive a mettre les données sur disque mais pas en temps réel donc si il y a une panne on ne récupère pas les dernières valeurs.
Dans ce TP, nous utiliserons Redis pour manipuler les principales opérations clé-valeur et comprendre comment fonctionne un SGBD en mémoire.
J’ai lancé Redis via Docker.  A l’aide de la commande suivante que vous trouverez sur mon screen,  j’ai réussi à lancer un conteneur Redis à partir de l’image redis.
  

puis j’ai pu accéder à  mon client Redis (redis-cli) à l’intérieur du conteneur Docker nommé monRedis.
  

Je suis donc sur le localhost qui écoute sur le port 6379.
Pour définir des clés et lui attribuer des valeurs je fais donc : 
  

  

J’ai donc ma clé valeur : (cle1, fatimazahra), (cle2, arthur) qui ont été définies. 
Pour récupérer une clé : 
  

Pour supprimer une clé : 
  

Le 1 sert a dire que ma clé existe bien, qu’il a pu la retrouver et la supprimer.
Si je retente de la supprimer, il me renvoie 0 parce que ma clé n’existe plus et il ne peut plus la supprimer.
  

L’un des cas d’utilisation de Redis c’est pour compter le nombre de visites d’un site. 
Pour démontrer ceci, je vais commencer par créer une clé que je vais initialiser le compteur à 0 pour dire que pour l’instant je n’ai aucun visiteur sur le site.
  

J'incrémente ma clé : 
  

Redis permet de traiter la concurrence donc le cas où plusieurs utilisateurs se connectent en même temps.
Pour décrémenter une clé: 
  

Pour savoir la durée de vie d’une clé :
  

Ceci veut dire que la durée de vie de ma cle1 est indéfinie c’est à dire jusqu'à ce que Redis ne lui reste plus de mémoire RAM.
Si je veux fixer une durée de vie d’une clé:
  

Ma cle1 expire au bout de 120s. 
Si je veux voir combien il lui reste en durée de vie : 
  

On peut définir plusieurs structures de données avec Redis. 
On va définir une liste :
  

  

Ici, j’ai inséré à droite de ma liste monCours les cours BDA et NoSQL.
Pour afficher le contenu de ma liste : 
  

0 c’est pour dire qu’il doit afficher à partir du premier élément de ma liste et -1 veut dire qu’il doit afficher tout c e qu’il y a dans ma liste.
Donc si je veux récupérer que le premier élément l’affichage doit commencer à l'indice 0 et finir à 0 : 
  

Pour supprimer un élément de ma liste : 
  

Le L dans LPOP c’est pour left donc il supprime l'élément à gauche de ma liste.
Pour cibler les éléments à droite, on utilise RPOP.
Si j’affiche ma liste je me retrouve avec : 
  

On manipule les set maintenant, ce sont des listes ou les éléments doivent être distincts.
Dans une liste je peux ajouter un même élément autant de fois que je veux ce qui n’est pas le cas dans un set.
On déclare un set utilisateurs auquel je vais ajouter les prénoms de mes utilisateurs: 
  

si j’essaye d’ajouter ethan une deuxième fois je vois bien qu’il me renvoie 0 pour me dire qu’il ne le prend pas en compte comme ethan existe déjà dans mon set.
  

Pour afficher les éléments d’un set:
  

Je ne peux pas supprimer un élément via son indice comme dans une liste classique car dans un set les indices n’ont pas d’importance. Pour supprimer un élément je précise sa valeur: 
  

Il me renvoie 1 pour me dire que arthur existe et qu’il a pu le supprimer. Si je réessaye, il me renvoie donc 0 pour m’informer que arthur n’existe plus dans mon set : 
  

Pour l’union des ensembles : 
Je crée un nouveau set : 
  

L’union : 
  

On manipule des sets ordonnées maintenant : 
Pour créer un set ordonne : 
  

Pour afficher les éléments d’un set ordonne : 
  

Les éléments ont été renvoyés par ordre croissant, du plus petit score au plus grand.
Si je veux les renvoyer dans l’ordre décroissant : 
  

Si on veut connaître l’indice d’un élément : 
  

On manipule maintenant les hash: 
Pour définir un hash : 
  

Pour récupérer tous les éléments de mon hash : 
  

Pour définir un hash en une fois pas ligne par ligne : 
  

On peut incrémenter un hash, je vais incrémenter l'âge d’Arthur de 10 : 
  

On peut récupérer toutes les valeurs de la clé hash: 
  

=> Redis est schemaless, il n’a pas de schéma commun, il offre une flexibilité et un passage à l'échelle facile.
On manipule des PubSub maintenant, utilisés dans les applications en temps réel.
Je m’inscrit à un canal  mescours. 
  

Un utilisateur publie un cours : 
  

Je reçois le cours en temps réel : 
  

=> tous les utilisateurs du canal reçoivent ce message.






Cette fois ci un utilisateur m’envoie à moi user1 un message : 
  

Je le reçois : 
  

Je peux aussi m’inscrire à plusieurs canaux, je m’inscris à tous les canaux qui commencent par mes:
  

Un utilisateur publie une note sur mesnotes qui commence par mes: 
  

Je les reçois : 
  

Pour avoir toutes les clés sauvegardes pour cette session : 
  

=> Redis met à disposition de ses utilisateurs 16 bases de données par défaut.
Par défaut on est connecté sur la base 0. Si je veux changer de base : 
  

Je suis sur la base 1 !
Si je cherche a savoir toutes les clés sauvegardées, y’en a pas : 
  

Je reviens sur la base 0.


Partie 2 : 
On s'intéresse maintenant à MongoDB.
J’installe le jeu de données et je lance MongoDB.


Partie 1 – Filtrer et projeter les données 
Afficher les 5 films sortis depuis 2015 : 
  











Trouver tous les films dont le genre est "Comedy"  :
  

Afficher les sortis entre entre 2000 et 2005 : 
  

Afficher les films de genres “Drama” ET “Romance”:
  

Afficher les films sans champ rated : 
  

Partie 2 – Agrégation
Afficher le nombre de films par année :
  

  

Afficher la moyenne des notes IMDb par genre:
  

Afficher le nombre de films par pays : 
  

Afficher les top 5 réalisateurs : 
  

Afficher les films triés par note IMDb : 
  

Partie 3 – Mises à jour : 
Ajouter un champ etat :
  

Incrémenter les votes IMDb de 100, par exemple : 
  

Supprimer le le champ poster : 
  

Modifier le réalisateur : 
  

Partie 4 – Requêtes complexes 
Afficher les films les mieux notés par décennie : 
  

Afficher les films dont le titre commence par “Star” : 
  

Afficher les films avec plus de 2 genres : 
  

Afficher les films de Christopher Nolan : 
  

Partie 5 – Indexation 
Créer un index sur year : 
  

Vérifier les index existants : 
  

Comparer deux requêtes avec et sans index (utiliser explain() ) : 
  

  

  

Supprimer l'index sur year : 
  

créer un index composé sur year et imdb.rating : 
  



Partie 3 : 
1/ Vérifier que le donnees ont ete importees, en les comptant par exemple : 
  

J’utilise la fonction countDocuments() pour vérifier que tous les documents ont bien été importés dans la collection films. La valeur retournée correspond au nombre total de films présents dans la base lesfilms.


2/ Récupérer un seul document pour regarder la structure complète d’un film : 
  

3/ Afficher la liste des films d’action : 
  

4/ Afficher le nombre de films d’action : 
  

5/  Afficher les films d’action produits en France : 
  

6/ Afficher les films d’action produits en France en 1963 : 
  

7/ Films d’action français sans afficher le champ grades : 
La commande initiale provoque l’erreur “Cannot do exclusion on field grades in inclusion projection”.
Pour corriger, j’ai utilisé soit uniquement des exclusions :
  

Soit uniquement des inclusions :
  

8/ Masquer les ids des films : 
  



9/ Afficher les titres et les grades des films d'action réalisés en France sans leurs 
identifiants : 
  

10/ Afficher les titres et les notes des films d’action réalisés en France et ayant obtenus une note supérieure à 10 : 
  

11/ Afficher les films d’action réalisés en France ayant obtenus que des notes supérieures à 10 : 
  

12/ Afficher les différents genres de la base lesfilms:
  

13/ Afficher les différents grades attribués :
  

14/ Afficher tous les filmes dans lesquels joue au moins un des artistes suivants [”artist:4”,”artist:18”,”artist:11”] : 
Dans cette base, les identifiants de la forme artist:XXX sont associés aux réalisateurs via le champ director._id, alors que la question semble parler d’artistes au sens d’acteurs.
De plus, les identifiants proposés dans l’énoncé (artist:4, artist:18, artist:11) n’existent pas dans les données réelles : aucune valeur de director._id ne correspond à ces IDs.
15/ Afficher tous les films qui n’ont pas de résumé :
  

16/ Afficher tous les films tournés avec Leonardo DiCaprio en 1997 : 
  

17/ Afficher les films tournés avec Leonardo DiCaprio ou 1997 :